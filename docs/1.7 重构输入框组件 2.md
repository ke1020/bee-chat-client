大家好，本节继续重构输入框组件。
打开输入框组件入口文件。
把词槽配置剪切到模型文件中管理。
在 models 目录下新建 。sender。ts 文件。
文件中专门负责管理。
输入框组件的状态、业务逻辑与异步副作用等。
把词槽配置粘贴到函数组件外部。
以减少每次渲染的开销。
我们把词槽配置修改为一个函数。
函数接受 。locale。 本地化对象。
返回值为词槽配置对象。
引入。Sender。Props。接口。
在函数组件中声明 。slot。Config。 变量。
存储获取的词槽配置对象。
使用 。use。Memo。钩子函数缓存词槽配置对象。
仅在。locale。对象发生变更时重新获取。
最后将 。slot。Config。添加到返回对象上。
回到输入框入口。
引入词槽配置对象。
接下来，我们给输入框组件添加一个头部。
头部主要是附件上传功能。
就像这样。
在输入框入口文件同级新建。Header。tsx。文件。
这里我直接将代码粘贴一下。
组件接受 4 个传入参数。
attachments。Open。表示附件上传功能显示状态开关。
true 为显示。
false 为隐藏。
set。Attachments。Open。是显示或隐藏附件上传功能的函数。
file。List。表示附件列表。
set。File。List。是设置附件列表的函数。
forward。Ref 主要是父组件将 Attachments 组件的 ref 传进来。
父组件文件粘贴事件需要直接操作 Attachments 组件。
下边 UI 代码中将传进来的参数绑定到组件上。
回到输入框入口。
将 。Header。组件引入。
将。Header。组件需要的 4 个属性复制。
在 。sender。模型文件中添加状态管理的代码。
locale。这里进行一下类型转换。
file。List。这里的类型是 Upload。File。any。数组类型。
最后添加到返回对象中。
回到输入框入口。
从 。sender。模型引入。
再添加到。Header。组件参数中。
这里还缺少一个按钮。
点击按钮时显示或隐藏附件上传功能。
我们打开。Footer。组件。
在深度思考按钮前边添加。
导入。Button。组件。
Paper。Clip。是一个别针图标。
attachments。Open。与。set。Attachments。Open。
通过 。props。 参数传递过来。
在 。Footer。Props。接口中添加这两个参数。
回到输入框入口。
给。Footer。组件添加参数。
打开浏览器看一下。
不错！工作的很好。
但是有一个问题。
右侧出现了双滚动条。
这是因为整体高度溢出了。

消息列表元素与输入框元素是兄弟元素。
它们的父元素是。flex。布局。
我们先给输入框 。style。 添加 flex。shrink。0。
防止输入框在空间不足时自动缩小。
然后，打开。Messages。组件
可以看到。
消息列表高度计算方式是百分之百减去 一百六十 像素。
一百六十 像素就是原输入框的高度。
现在因为增加了附件上传的部分。
所以高度计算方式需要修改。
这里我们给它添加上。
flex 值为 1 表示占满剩余空间。
overflow 溢出显示滚动条。
三个要素。
父元素 是。flex。布局。
输入框固定高度。
剩余部分填充剩余空间。
打开浏览器再次预览。
现在页面高度溢出的问题就解决了。

回到输入框入口。
我们再来粘贴一段粘贴上传的代码。
attachments。Ref 表示创建一个上传组件实例的引用。
pending。Files。Ref。也是创建一个引用，
用于存储待处理的文件。
当附件面板未打开时暂存粘贴的文件。
on。Paste。File。是处理粘贴文件的回调函数。
当用户粘贴文件时。
会触发此函数。
并传入一个 。File。List。对象。
判断如果附件面板已经打开。
并且附件组件已挂载。
则直接调用 attachments。Ref。current。upload(file) 上传每个文件。
如果附件面板未打开。
则将文件暂存到 pending。Files。Ref。current。中。
并打开附件面板。

使用 use。Layout。Effect。确保在 DOM 更新后同步执行。
避免文件上传时附件组件尚未完成渲染。
在附件面板打开后立即处理暂存文件。
request。Animation。Frame。
确保在浏览器下一次重绘前执行，DOM。已更新完成。
cancel。Animation。Frame。(raf.Id) 。
表示组件卸载时取消未执行的动画帧回调。
防止内存泄漏。

把 on。Paste。File。添加到 。Sender。组件上。
把附件组件的 ref 传递给 Header 组件。
最后切换到浏览器测试一下。

以上就是本节内容。