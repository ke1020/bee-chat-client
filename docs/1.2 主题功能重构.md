上节视频中。
我们对 AI 对话工具的本地化功能进行了重构。
其实还遗留了一点小问题。
什么问题呢？
就是 X。Provider 组件 local 属性，这里有一个类型警告。
实际上 local 属性是是 ant。d 组件类型。
加上 ant。design。x 组件类型。
再加上我们这个工具的类型。
它是一个联合类型。
而我们这个 local 对象标注的类型仅有 Ai。Chat。Local。
所以我们还需要加上 X。Provider。Props。local 类型。
X。Provider。Props。local 就是 ant。d 加 ant。design。x 的联合类型。
类型声明的地方也要添加。
添加之后，警告就消失了。

接下来，我们开始本节内容。
主题功能重构。
我们从官方拷贝的示例中，
仅有一段关于样式的定义。
对主题方面没有过多内容。
现在我们要做的是，
将样式从 index.tsx 文件中抽取出来。
放到 themes。ts 文件中。
themes。ts 文件专门管理主题与样式相关的数据状态。
业务逻辑与异步副作用等。
符合单一职责原则。
我们在 models 目录下。
新建 themes.ts 文件。
将主题管理相关粘贴到文件中。
导入 store 。2 库。
用于将主题设置持久化存储到 localStorage 中。
定义支持的主题类型。
Theme。Mode 表示只能从主题中选择一个。
Theme。Setting 主题设置在 Theme。Mode 基础上添加 auto。
auto 表示自动跟随系统主题。
THEME。PALETTE 用于配置每种主题的颜色及算法。
暗色与亮色主题直接使用 ant。d 组件的算法。
createStyles 是 antd。style 库提供的一个 CSS。in 。JS 样式生成函数。
它返回一个 useStyles 钩子。
props 被用来传递主题模式。
我们可以根据 props.themeMode 获取对应的主题配置。
下边这一部分就是 index。tsx 文件中抽取过来的样式。
我们把 token 替换成我们自定义的主题设置。
除此之外，我们还为 agent。Name 与 chat。List 增加了 color 设置。
从本地存储读取主题设置。
设置主题到本地存储。
获取系统主题是亮色还是暗色。

Use。Theme。Return 是此文件返回的数据类型签名。

计算当前实际主题。
缓存计算结果，避免不必要的重新计算。
theme。Config 是从主题配置中获取当前主题的算法。
theme。Config 最终会绑定到 x。Provider 组件的 theme 属性上。
监听系统主题变化。
当设置为 auto 时。
系统主题变化会自动更新 current。Theme。
切换主题的函数。
最后返回主题相关数据与切换主题的方法。

回到 index。tsx 页面。
在导入 local 数据的下方。
添加主题 styles 的导入。
删除 styles 相关的内容。
还需要导入 theme。Config 对象。
并将它绑定到 x。Provider 组件的 theme 属性上。
打开浏览器开发工具。
在应用程序标签。本地存储菜单右侧。
添加或修改键 theme。setting 。值 dark 。 light 。 或 auto。
然后刷新页面。
可以看到主题已经成功切换了。
当我们设置为 auto 的时候。
打开系统主题设置。
切换主题。
可以看到我们的应用主题。
也已经跟随系统主题发生变更了。
本节视频，我们重构了 AI 对话工具的主题模块。
感谢大家观看。

这样我们只需要在 themes。ts 文件中。
为 markdown 组件增加一个样式类名。
然后，让它跟随主题变化。
最后将样式类名绑定到 markdown 组件的 className 属性上。
在 Use。Theme。Return。类型声明中。
添加 markdown。Theme。Class。字符串类型。
在 theme。Config 下方吧。
增加样式类型变更的逻辑。
当 current。Theme 为 dark 时使用 x。markdown。dark。
否则使用 x。markdown。light。
最后将 markdown。Theme。Class。 添加到返回对象上。
回到 index。tsx 文件。
从 themes。ts 文件中导入 markdown。Theme。Class。
删掉 use。Markdown。Theme 这里的旧代码。
把 get。Role 这里的 class。Name。替换为 markdown。Theme。Class。
get。Role 方法中 x。Markdown 组件应用的就是这个样式类名。
删掉 x。markdown。utils。的导入。
切换到浏览器。
可以看到 markdown 组件样式已经切换到 dark 模式了。
修改 theme。setting 为 light。
刷新页面。
markdown 样式已经切换到 light 模式了。
我们打开系统的主题设置。
点击明/暗模式切换。
可以看到应用的主题也跟随系统主题切换了。

本节视频，我们重构了 AI 对话工具的主题模块。
感谢大家观看。