# 按照 @umi/max 简易数据流拆分 Home 页面

## 拆分目标

将 [index.tsx](file:///c:/Users/ke/dev/proj/tools/BeeChat/bee-chat/src/pages/Home/index.tsx) 中的业务逻辑和状态管理提取到 model 中，实现关注点分离。

## 拆分方案

### 1. 创建 chat model (`src/models/chat.ts`)

管理对话相关的状态和逻辑：

* conversations 列表状态

* curConversation 当前对话 key

* activeConversation 激活对话 key

* deepThink 深度思考开关

* provider 缓存管理

* 方法：addConversation, deleteConversation, setCurConversation, setActiveConversation, toggleDeepThink

### 2. 创建 message model (`src/models/message.ts`)

管理消息相关的状态和逻辑：

* messages 消息列表

* isRequesting 请求状态

* onRequest 发送消息

* onReload 重新生成

* abort 中止请求

* provider 创建和缓存

### 3. 创建 constants 文件 (`src/constants/chat.ts`)

提取常量配置：

* DEFAULT\_CONVERSATIONS\_ITEMS

* HISTORY\_MESSAGES

* slotConfig

### 4. 创建 components 文件 (`src/pages/Home/components/`)

拆分 UI 组件：

* `Footer.tsx` - 消息底部操作栏

* `ChatLayout.tsx` - 整体布局

* `Sidebar.tsx` - 侧边栏对话列表

* `ChatArea.tsx` - 聊天区域

* `StartPage.tsx` - 初始页面

### 5. 重构 index.tsx

简化主组件，使用 useModel hooks：

* 使用 useModel('chat') 获取对话状态和方法

* 使用 useModel('message') 获取消息状态和方法

* 只保留 UI 渲染逻辑和事件绑定

## 优势

* ✅ 业务逻辑与 UI 分离

* ✅ 状态集中管理，易于维护

* ✅ 组件复用性提高

* ✅ 符合 @umi/max 最佳实践
